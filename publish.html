<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    	<title>Tadpole :: Publish</title>
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
        <script type="text/javascript" src="lib/air/AIRAliases.js"></script>
        <script type="text/javascript" src="lib/air/AIRLocalizer.js"></script>
		<script type="text/javascript" src="lib/prototype/prototype.js"></script>
		<script type="text/javascript" src="lib/scriptaculous/scriptaculous.js"></script>
		<script type="text/javascript" src="lib/scriptaculous/effects.js"></script>
		<script type="text/javascript" src="lib/tadpole.js"></script>
        <script type="text/javascript">
            // AIR-related functions created by the developer
            
			var session = {
				authToken: readLocalFile()		
			};
			
            // reads the content of a local text file
            function readLocalFile(){
                var f = air.File.applicationStorageDirectory.resolvePath("pond.txt");
				
                var fs = new air.FileStream();
                fs.open(f, air.FileMode.READ);
                var content = fs.readUTFBytes(fs.bytesAvailable);
                fs.close();
                
                return content;
            }
			
			var friends = [];
			
            function sendPost(ev){
				ev.stop();
				var params = {
							AuthToken: session.authToken,
							ServiceIDs: "1+6"
						};
						
				new Ajax.Request("http://services.sapo.pt/Pond/ListAccountsJSON",{
					method: 'get',
					parameters: params,
					onComplete: function(r){
						
						var data = r.responseJSON.Response.Accounts;
						
						var accounts = [];
						
						for (var _i = 0; _i < data.length; _i++) {
							var params = {
								AuthToken: session.authToken,
								"AccountID": data[_i].Account.AccountID,
								SmallText: $('text').value
							};
							
							new Ajax.Request($('post').action, {
								method: 'get',
								parameters: params,
								onComplete: function(r){
									$('info').innerHTML = "Message Posted";
									$('status-messages').style.display = "block";	
								}
							});
						}
						
					}
				});
				
						
			}
			
			function check(){
				var arr = document.location.href.split("#");
				if(arr.length  && arr.length>1){
					$('text').value = arr[1];
				}				
			}
            
       </script>
	</head>

    <body onload="check()">
		<div id="status-messages" style="display: none;">
			<ul>
				<li class="error"></li>
				<li class="warning"></li>
				<li id="info" class="info"></li>
			</ul>
    	</div>
    	<div id="topbar" onclick="toggleEffect($('status-messages')); return false;" style="cursor: pointer">
    		<p class="left">x Messages</p>
			<p class="right"><img src="img/world_connect.png" alt="status" title="online" /></p>
    	</div>
        <div id="contents-wrapper">
		
			<div class="publish-area">
				<form id="post" method="get" action="http://services.sapo.pt/Pond/PostEventJSON" onsubmit="return sendPost(event)">
					<textarea class="content" id="text" name="SmallText"></textarea>
					<br />
					<div class="services">
						<input class="service" type="checkbox" id="twitter" checked="checked" />
						<label for="twitter" class="twitter">twitter</label>
						<input class="service" type="checkbox" id="facebook" checked="checked" />
						<label for="facebook" class="facebook">facebook</label>
					</div>
					<input class="button" type="submit" value="Submeter" />
				</form>
			</div>
		
		</div>
		<div class="main-menu-wrapper closed">
			<a href="#menu" class="main-menu-link" onclick="toggleEffect($('mainOptions')); return false;">Menu</a>
			<div id="mainOptions" class="main-menu-options" style="display: none">
				<ul>
					<li class="publish"><a href="publish.html">Publish</a></li>
					<li class="timeline"><a href="timeline.html">Timeline</a></li>
					<li class="me"><a href="me.html">Me</a></li>
					<li class="friends-list"><a href="friends.html">FriendsList</a></li>
					<li class="logout"><a href="logout.html">Logout</a></li>
				</ul>
			</div>
		</div>
    </body>
</html>