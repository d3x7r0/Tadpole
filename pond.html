<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Tadpole :: Login</title>
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
        <script type="text/javascript" src="lib/air/AIRAliases.js"></script>
        <script type="text/javascript" src="lib/air/AIRLocalizer.js"></script>
		<script type="text/javascript" src="lib/prototype/prototype.js"></script>
		<script type="text/javascript" src="lib/tadpole.js"></script>
        <script type="text/javascript">
            // AIR-related functions created by the developer
 
			var session = {
				authToken: readLocalFile()				
			};
            
            // loads the content of a remote URL
            function doRequest(url) {
               var req = new XMLHttpRequest();
               req.onreadystatechange = function() { 
                    if (req.readyState == 4) {
                        var str = req.responseText;
                        if (str.length > 400) {
                            str = str.substring(0, 399);
                            str += "..";
                        }
                        alert('readystate: ' + req.readyState + '\n' +
                            'status/statusText: ' + req.status + '/' + 
                             req.statusText + '\n' +
                            'responseText (400 chars): '  + "\n\n" + str);
                    }
                };
                req.open('GET', url, true);
                req.send(null);                
            }

			function doLogin(ev){
				ev.stop();
				var username = $('username').value;
				var password = $('password').value;
				
				new Ajax.Request("https://services.sapo.pt/Pond/GetAuthTokenJSON",{
					parameters: {
						'Username': username,
						'Password': password 						
					},
					onComplete: function(r){
						if(r.responseJSON.Response){
							authToken = r.responseJSON.Response.AuthToken;
							saveLocalFile(authToken)
						} else {
							alert('wrong username and/or password');							
						}
					}
				});
			}
			
			function openInBrowser(url) {
				air.navigateToURL( new air.URLRequest(url)); 
			}
            
			function goTimeline(){
				if(session.authToken){
					window.location = "timeline.html";
				}
			}
        </script>
	</head>

    <body onload="goTimeline()">
        <div id="contents-wrapper">
			<div id="contents">
				<form action="" id="login-form" onsubmit="doLogin(event);">
					<h1>Login:</h1>
					<label for="username">Username:</label>
					<input id="username" type="text" name="username" />
					<label for="password">Password:</label>
					<input id="password" type="password" name="password" /><br />
					<input id="submit" type="submit" class="button" value="OK" />
				</form>
			</div>
		</div>
    </body>
</html>